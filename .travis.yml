language: python

sudo: false

matrix:
    include:
        - python: 2.7
          env: BUILD=TEST

        - python: 3.4
          env: BUILD=TEST

        - python: 3.5
          env: BUILD=TEST

        # TODO: add tests for installed version!!

        - python: 2.7
          env: BUILD=DOCS

        - python: 3.4
          env: BUILD=DOCS

        - python: 3.5
          env: BUILD='COVERAGE'

        - python: 3.5
          env: BUILD=NO_EXTRA_DEPS


before_install:
  - pip install setuptools Cython
  - if [[ $BUILD != NO_EXTRA_DEPS ]]; then pip install IPython numpy matplotlib coverage; fi
  - if [[ $BUILD == DOCS ]]; then pip install matplotlib sphinx sphinx_rtd_theme; fi

install:
  - python setup.py build_ext -i

script:
  - if [[ $BUILD == TEST ]]; then python -m pytest -v iminuit; fi
  - if [[ $BUILD == COVERAGE ]]; then python -m pytest -v iminuit --cov iminuit --cov-report html; fi
  # TODO: add -W option to Sphinx build once this Sphinx bug is fixed:
  # https://github.com/iminuit/iminuit/pull/132#issuecomment-62139507
  - if [[ $BUILD == DOCS ]]; then cd doc; sphinx-build -a -E -b html -d _build/doctrees . _build/html; fi
